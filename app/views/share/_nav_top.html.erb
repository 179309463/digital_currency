<style>
  .minWidth {
    min-width: 1200px;
    width: 1200px;
    margin: 0 auto
  }

  .minWidth .leftSise {
    float: left
  }

  .minWidth .rightSise {
    float: right
  }

  .minWidth:after {
    content: '';
    display: block;
    width: 100%;
    clear: both
  }
</style>
<div class="minWidth" id="globalinfo">
  <style>
  .totalvolcap.text-red:after {
    content: url('<%= asset_path("arrow-d4.svg")%>')
  }

  .totalvolcap.text-green:after {
    content: url('<%= asset_path("arrow-u3.svg")%>')
  }
  </style>
  <style>
  .space:before {
    content: '/';
    margin: 0 5px;
    font-style: normal
  }
  </style>
  <div class="leftSise">虚拟币：
    <a href="/currencies/">1151</a>
    <i class="space"></i>代币：
    <a href="/assets/">601</a>
    <i class="space"></i>交易平台：
    <a href="/exchange/">252</a>
    <i class="space"></i>24小时成交量：
    <a id="total_vol" class="totalvolcap" href="/pages/charts">¥1937.96亿</a>
    <i class="space"></i>总市值：
    <a id="total_cap" class="totalvolcap" href="/pages/charts">¥33040.80亿</a>
    <i class="space"></i>GBI指数：
    <a id="total_gbi" class="totalvolcap" href="/pages/gbi">14324.07</a></div>
  <div class="leftSise"></div>
  <style>
    .loginbar>a, .loginbar>div {
      display: block;
      float: right;
      height: 30px;
      line-height: 31px;
      margin-left: 20px;
    }  
    nav .rightSise {
      overflow: visible !important;
    }
  </style>
  <div class="rightSise loginbar">
    <style>
      .getgroup {
        margin-left: 30px !important;
        position: relative;
        padding: 0 5px;
        cursor: pointer;
      }

      .getgroup:hover {
        background: #ddd;
      }

      .getgroup ul {
        position: absolute;
        z-index: 999999;
        background: #ddd;
        left: 0;
        top: 30px;
        padding: 5px 0;
        display: none;
      }

      .getgroup a {
        float: none;
        vertical-align: middle;
        line-height: 15px;
        display: block;
        height: 26px;
        width: 100%;
      }

      .getgroup a img {
        margin-top: 4px;
      }

      .getgroup ul li {
        height: 30px;
        overflow: hidden;
        padding: 0 10px;
      }

      .getgroup li:hover img {
        box-shadow: 0px 0px 2px #333;
      }

      .getgroup:hover ul {
        display: block;
      }
    </style>
    <div class="getgroup">官方交流群
      <ul>
        <li>
          <a href="#" target="_blank">
            <img alt="东方币湾官方电报群" src="<%= asset_path("telegram.png")%>"></a></li>
        <li>
          <a href="#" target="_blank">
            <img alt="东方币湾官方QQ群368805087" src="//pub.idqqimg.com/wpa/images/group.png"></a>
        </li>
      </ul>
    </div>&nbsp;&nbsp;
    <style>
    .userLinks a {
      vertical-align: 0 !important;
    }
    </style>
    <div class="userLinks userinfo" style="display: none">
      <a class="username" href="/user/setting"></a>&nbsp;&nbsp;|&nbsp;&nbsp;
      <a rel="nofollow" onclick="javascript: logout(); return false; ">退出</a>
    </div>&nbsp;&nbsp;
    <div class="userLinks unlogin" style="display: none">
      <a rel="nofollow" class="login">登陆</a>&nbsp;&nbsp;|&nbsp;&nbsp;
      <a rel="nofollow" class="signup">注册</a>
    </div>
  </div>      
</div>


<script>
  /**
   * Created by zfd on 2017/3/28.
   */

  //手机格式
  function checkPhone(p) {
     
      var re = /^1(3|4|5|7|8)\d{9}$/;
      if (!re.test(p)) {
          return false;
      }
      else return true;
  }
  //邮箱验证
  function checkEmail(e) {
      var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
      if (!myreg.test(e)) {
          return false;
      }
      else return true;
  }
  //帐号验证
  function checkAccount() {
      var account = $('.signupForm .account').val();
      if (account.length > 0) {
       
              if (!checkEmail(account)) {
                  $('.account').next('.alert').html("*邮箱格式不正确").css('display', 'block');
                  $('.hasBtn').val('').css('display', 'none'); 
                  return false
              }
              else { $(".hasBtn").css("display", 'none').val('');  return true }
         
      }
      else {
          $('.account').next('.alert').html("*邮箱不能为空").css('display', 'block');
          $('.hasBtn').val('').css('display', 'none'); return false
      }
  }

  function outerWindow(a) {
    var $html = $("<div class='outerWindow'><div class='windowHead'><button class='close'>×</button></div><form action=''method='post'class='loginForm'style='display: none'><div class='title'>使用邮箱登陆</div><div class='formItem'><input type='text'class='username'placeholder='输入用邮箱'><p class='alert'></p></div><div class='formItem'><input type='password'class='password'placeholder='输入密码'><p class='alert'></p></div><div class='formItem' style='display:none;'><input type='checkbox' id='rememberme' class='checkbox'  > 记住密码</div><div class='formItem'><button class='btn'type='button'>立即登陆</button><p class='alert'>*帐户名或者密码不正确</p></div><div class='links'><a href='' target='_blank' class='findPassword'>忘记密码</a><span>没有帐号？<a rel='nofollow'class='signup'>立即注册</a></span></div></form><form action=''method='post'class='signupForm'><div class='title'>用户注册</div><div class='formItem'><input type='text'class='account'placeholder='输入邮箱地址'><p class='alert'></p></div><div class='formItem'><input type='password'class='setPassword'placeholder='输入密码'><p class='alert'></p></div><div class='formItem'><input type='password'class='rePassword'placeholder='再次输入密码'><p class='alert'></p></div><div class='formItem hasPic'><input type='text' class='imgcode'placeholder='输入右边的验证码'><div class='pic'><img id='verifyImage' style='cursor:hand' height='34' title='点击刷新验证码' onclick=\"this.src='/user/verifyimage.jpeg?time=' + new Date()\" /></div><p class='alert'></p></div><div class='formItem hasBtn'><input type='text'class=''placeholder='输入收到的验证码'><button class='getCode'type='button'>获得验证码</button><p class='alert'></p></div><div class='formItem'><button class='btn'type='button'>立即注册</button><p class='alert'>*用户名已存在</p></div><div class='formItem'><div class='links'>已有帐号？<a rel='nofollow'class='login'>立即登陆</a></div></div></form> <div class='tips'><i></i><div class='text'>注册成功</div><a rel='nofollow' class='sure'>确定</a></div></div>");
    
  var $style = $("<style>.outerWindow{width:450px;min-height:320px;background:#fff;border-radius:10px;box-shadow:0 0 10px #666;position:fixed;left:50%;margin-left:-250px;display:none;padding-bottom:10px}.outerWindow .close{float:right;background:none;border:none;width:30px;height:30px;color:#666;font-size:30px;cursor:pointer;overflow:hidden;outline:none;}.outerWindow .title{font-size:16px;color:#999;text-align:center;position:relative;margin-bottom:10px;margin-top:30px;}.outerWindow .title:before{content:'';border-top:1px solid #ededed;display:block;position:absolute;width:50px;top:8px;left:0;}.outerWindow .title:after{content:'';border-top:1px solid #ededed;display:block;position:absolute;width:50px;top:8px;right:0;}.outerWindow .windowHead{width:100%;overflow:hidden;height:30px;}.outerWindow form{width:300px;display:block;margin:0 auto;display:none;}.outerWindow form input{width:288px;height:23px;padding:5px;border-radius:5px;border:1px solid #ddd;background:#fcfcfc;font-size:14px;color:#444;outline:none;}.outerWindow .alert{padding:0;margin:5px 0;color:red;font-size:12px;display:none;}.outerWindow .btn{width:298px;height:35px;border:1px solid #0043c9;border-radius:5px;background:#3273e4;color:#fff;outline:none;}.outerWindow .formItem{overflow:hidden;width:100%;height:auto;margin:15px 0;}.outerWindow a{text-decoration:none;color:#3273e4;}.outerWindow a:hover{text-decoration:underline;}.outerWindow .links{font-size:13px;}.outerWindow .links span{float:right;}.outerWindow .con{width:300px;margin:0 auto;text-align:center;}.outerWindow .icon{display:inline-block;height:48px;width:48px;background:url('<%=asset_path("icon.svg")%>') no-repeat;margin:0 10px;border-radius:50%;}.outerWindow .icon:hover{box-shadow:0 0 5px #999;}.outerWindow .con .qq{background-position:-82px -2px;}.outerWindow .con .xl{background-position:-2px -2px;}.outerWindow .con .wx{background-position:-162px -2px;}.outerWindow .hasBtn input{width:167px;}.outerWindow .hasBtn{display:none;}.outerWindow .hasBtn button{width:110px;height:35px;border-radius:5px;border:1px solid #ddd;background:#f1f1f1;margin-left:10px;outline:none;}.outerWindow button:hover{opacity:0.8;cursor:pointer;} .outerWindow .checkbox{ color: #3273e4;text-decoration: none;}        .outerWindow  .hasPic input{width: 167px;}.outerWindow  .hasPic .pic{width: 110px;height: 35px;background: #f1f1f1;display: block;float: right}.outerWindow  .hasPic .pic img{width: 100%;height:100%;}.outerWindow .checkbox{display: inline-block;width: 15px;height: 15px;vertical-align: middle}.outerWindow .formItem{font-size: 14px;} .outerWindow {z-index:9999;}.outerWindow .tips{width:300px;margin:0 auto;margin-top:70px;text-align:center; display:none;}.outerWindow .tips i{width:95px;height:95px;display:block;background:url('<%=asset_path("success")%>') top center no-repeat;margin:0 auto;}.outerWindow .tips .text{font-size:25px;margin:15px 0;}.outerWindow .tips button{width:200px;height:30px;border:1px solid #ddd;border-radius:5px;background:#f1f1f1;color:#333;outline:none;margin-top:30px;}</style>")

      $html.find(".findPassword").attr('href', a.findPassword);
      $html.find(".loginForm").attr('action', a.loginUrl);
      $html.find(".signupForm").attr('action', a.signupUrl);
      $html.find(".xl").attr('href', a.xinlang);
      $html.find(".qq").attr('href', a.QQ);
      $html.find(".wx").attr('href', a.weixin);
      $('head').append($style);
      $('body').append($html);
      //弹出
      $('body,html').on('click', a.login, function () {
      
          $('.outerWindow').css('display', 'block').css('top', window.innerHeight / 2 - 200 + 'px');
          $('.outerWindow form').css('display', 'none');
          $('.loginForm').css('display', 'block');
      })
      $('body,html').on('click', a.signup, function () {
      $html.find("#verifyImage").trigger('click');
          $('.outerWindow').css('display', 'block').css('top', window.innerHeight / 2 - 200 + 'px');
          $('.outerWindow form').css('display', 'none');
          $('.signupForm').css('display', 'block');
      })
      //改变窗口大小
      $(window).resize(function () {
          if ($('.outerWindow').css('display') != 'none') {
              $('.outerWindow').css('display', 'block').css('top', window.innerHeight / 2 - 200 + 'px');
          }
      });
      //获得验证码
      var time;
      var clo;

      $('body').on('click', '.signupForm .getCode', function () {
          clo = 59;
          //插入发送请求的方法
          $('.getCode').attr('disabled', 'disabled').html('(59)获得验证码');
          time = setInterval(clock, 1000);
      });
      function clock() {
          if (clo != 0) {
              clo = clo - 1;
              $('.getCode').html('(' + clo + ')获得验证码');
          }
          else if (clo == 0) {
              $('.getCode').html('获得验证码').removeAttr('disabled');
              window.clearInterval(time);
          }
      }
      
     
      //关闭
      $('body,html').on('click', '.outerWindow .close', function () {
          $('.outerWindow form').css("display", 'none');
          $('.outerWindow').css('display', 'none');
          $('.signupForm,.loginForm')[0].reset();
          $('.signupForm .hasBtn').css('display', 'none');
      })
      //是否手机注册
      $('body,html').on('keyup', '.signupForm .account', function () {
          $('.signupForm .account').next('.alert').css("display", 'none');
          checkAccount();
      })

      $('body').on('keyup', '.setPassword', function () {
          checkPwd($('.setPassword').val().trim());
      });

      $('body').on('keyup', '.setPassword', function () {
          checkPwd($('.setPassword').val().trim());
      });

      //提交注册
      $('body').on('click', '.signupForm .btn', function () {
          $('.signupForm .alert').css("display", 'none');
          var count1 = 0
          if (!checkAccount()) { count1 = count1 + 1 }//else{ window.clearInterval(time);};
          
          if (!checkPwd($('.setPassword').val().trim())) {
              count1 = count1 + 1;
          }
          //验证密码是否为空
          if ($('.setPassword').val().trim() == '') {
              $('.setPassword').next('.alert').html('*密码不能为空').css("display", 'block'); count1 = count1 + 1
          }
          //验证两次输入密码
          if ($('.rePassword').val().trim() == '') {
              $('.rePassword').next('.alert').html('*两次密码输入必须一致').css("display", 'block'); count1 = count1 + 1
          }
          else if ($('.rePassword').val().trim() != $('.setPassword').val()) {
              $('.rePassword').next('.alert').html('*两次密码输入必须一致').css("display", 'block'); count1 = count1 + 1
          }
          if ($('.imgcode').val().trim() == '') {
            
              $('.pic').next('p.alert').html('*验证码不能为空').css("display", 'block'); count1 = count1 + 1
          }
          
          
          if (count1 == 0) {
              $('.signupForm .btn').attr("disabled", "disabled");
              $('.signupForm .btn').html("提交中..."); 
              var parms = new Object();
              parms["userid"] = $('.account').val().trim();
              parms["password"] = $('.setPassword').val().trim();
              parms["confirmPwd"] = $('.rePassword').val().trim();
              parms["verifyCode"] = $('.hasPic input').val().trim();
              $.post("/user/post.register", parms, registerResponse) 
          }//或者ajax
          else { return false }
      })
      //立即注册
      $('body').on('click', '.outerWindow .signup', function () {
          $('.outerWindow .alert').css("display", 'none');
          $('.outerWindow .loginForm')[0].reset();
          $('.outerWindow .loginForm').css('display', 'none');
          $('.outerWindow .signupForm').css('display', 'block')
      })
      //立即登陆
      $('body').on('click', '.outerWindow .login', function () {
          $('.outerWindow.alert').css("display", 'none');
          $('.outerWindow .signupForm')[0].reset();
          $('.signupForm .hasBtn').css('display', 'none');
          $('.outerWindow .signupForm').css('display', 'none');
          $('.outerWindow  .loginForm').css('display', 'block')
      })
      //登陆检测
      $('body').on('click', '.loginForm .btn', function () {
          var cou = 0;
          if ($('.loginForm .username').val().trim() == '') {
              $('.loginForm .username').next('.alert').html("*帐号名不能为空").css('display', 'block');
              cou = cou + 1

          }
          if ($('.loginForm .password').val().trim() == '') {
              $('.loginForm .password').next('.alert').html("*密码名不能为空").css('display', 'block');
              cou = cou + 1
          }
          if (cou != 0) {
              return false;
          } else {
   
              $('.loginForm .btn').attr("disabled", "disabled");
              $('.loginForm .btn').html("登陆中...");

              var parms = new Object();
              parms["userid"] = $('.loginForm .username').val().trim();
              parms["password"] = $('.loginForm .password').val().trim();

              parms["isRemember"] = $('#rememberme').is(':checked');
              $.ajax({
                  url: "/user/post.login",
                  data: parms,
                  type:"post",
                  async: true, 
                  xhrFields:{
                      withCredentials:true
                  },
                  success: function (data) { 
                      loginResponse(data);
                  } 
              });

               
          }

      })
  }//end

  //处理登录的反馈信息
  function loginResponse(data) {
      var result = eval("(" + data + ")");
      if (result.status == "success") { 
          window.location.reload(); 
      }
      else {
          $('.loginForm .btn').next('.alert').html(result.content).css("display", 'block');
      }
      $('.loginForm .btn').removeAttr("disabled");
      $('.loginForm .btn').html("立即登陆");

  }

  //处理注册的反馈信息
  function registerResponse(data) { 

      var result = eval("(" + data + ")"); 
      if (result.status == "success") {
          $('.outerWindow .signupForm,.outerWindow .loginForm').css('display', 'none');
          $('.outerWindow .tips').css("display", 'block');
         // $(".signupForm .login").trigger("click");
      }
      else if (result.status == "exception") {
          $('.signupForm .btn').next('.alert').html(result.content).css("display", 'block'); 
      }
      else if (result.status == "error") {
          $('.signupForm .btn').next('.alert').html(result.content).css("display", 'block');
      }
      $('.signupForm .btn').removeAttr("disabled");
      $('.signupForm .btn').html("立即注册");
  }

  function checkPwd(  pwd) {
     // var strongRegex = new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\W).*$", "g");
      //var mediumRegex = new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$", "g");
      var enoughRegex = new RegExp("(?=.{6,}).*", "g");
      if (false == enoughRegex.test(pwd)) {
          $('.setPassword').next('.alert').html('*密码太短，密码长度须大于6位').css("display", 'block');
          return false;
      }
      else  {
          $('.setPassword').next('.alert').html('').css("display", 'none');
          return true;
      } 
  }
  $('body').on('click', '.outerWindow .sure', function () { 
          $('.outerWindow .tips').css('display', 'none');
          $('.outerWindow  .loginForm').css('display', 'block')
  })

  function addfocus() {
      $(".login").click();
  }






         
  var seting = {
    "login": ".login",
    "signup": ".signup",
    "findPassword": "/user/findpwd",
    "loginUrl": "登陆表单提交地址",
    "signupUrl": "注册表单提交地址",
    "xinlang": "/weibo/weibologin",
    "QQ": "/qqoauth/qqLogin",
    "weixin": "/wechat/wechatlogin",
  }
  outerWindow(seting)  







  function getUserInfo() {
    $.ajax({
        type: "GET",
        url: "/user/login.json",
        xhrFields: {
            withCredentials: true
        },
        success: function (data) {
            var result = data;

            if (result.status == "success") {
                if (result.username.length > 0 || result.userid.length > 0) {
                    $(".userinfo").css('display', 'block');
                    $(".unlogin").css('display', 'none');
                    if (result.username.length > 0) {
                        $(".userLinks .username").html(result.username);
                    } else {
                        $(".userLinks .username").html(result.userid);
                    }

                    return;
                } else {
                    $(".userLinks .username").html(result.userid);
                }

            }

            $(".userinfo").css('display', 'none');
            $(".unlogin").css('display', 'block');


        }
    })
  };
  getUserInfo();
</script>