<style>
.addto {
  float: right;
  background: #1d80bf;
  color: #fff !important
}

.hasaddto {
  float: right;
  background: #e40101;
  color: #ffffff !important;
}

.addto, .hasaddto {
  cursor: pointer;
}

table .addto, table .hasaddto {
  background: none;
  color: #1d80bf !important;
  float: left !important;
  height: auto;
  padding: 0;
  margin-top: 0;
  margin-left: 0;
  line-height: normal;
  width: 80px;
}
</style>
<div class="m15"></div>
<style>

.slideBtn span:after {
    margin-left: 2px
}

.slideBtn {
    position: relative;
    display: inline-block;
    z-index: 9999
}

.slideBtn button, .slideBtn>a {
    height: 32px;
    display: inline-block;
    border: 1px solid #eaecef;
    border-radius: 3px;
    position: relative;
    background: #fff;
    padding: 5px 10px;
    color: #333;
    cursor: pointer;
    transition: all .3s
}

.slideBtn button:hover {
    background: #3499da;
    color: #fff
}

.slideBtn span {
    line-height: 32px;
    padding: 0 10px
}

.slideBtn ul {
    position: absolute;
    border: 1px solid #eaecef;
    box-shadow: 1px 1px 3px #eaecef;
    margin-left: -1px;
    margin-top: 5px;
    background: #fff;
    padding: 3px 0;
    border-radius: 3px;
    display: none;
    white-space: nowrap;
    min-width: 100%
}

.slideBtn ul li a {
    padding: 3px 10px;
    display: block;
    text-decoration: none;
    height: 25px;
    line-height: 25px;
    color: #333
}

.slideBtn ul li a:hover {
    background: #3499da;
    color: #fff
}

.slideBtn button:active {
    background: #3499da;
    color: #fff
}
</style>
<style>
.unit ul li {
    width: 120px;
    float: left
}

.unit ul {
    width: 600px
}
</style>
<div class="slideBtn unit">
  <button>人民币(CNY)</button>
  <ul>
    <li class="pointer">
      <a href="index.html#native" class="price-toggle" data-currency="native">平台价格</a></li>
    <li>
      <a href="index.html#CNY" class="price-toggle" data-currency="cny">人民币(CNY)</a></li>
    <li>
      <a href="index.html#USD" class="price-toggle" data-currency="usd">美元(USD)</a></li>
    <li>
      <a href="index.html#BTC" class="price-toggle" data-currency="btc">比特币(BTC)</a></li>
    <li>
      <a href="index.html#ETH" class="price-toggle" data-currency="eth">以太坊(ETH)</a></li>
    <li>
      <a href="index.html#JPY" class="price-toggle" data-currency="jpy">日元(JPY)</a></li>
    <li>
      <a href="index.html#KRW" class="price-toggle" data-currency="krw">韩币(KRW)</a></li>
    <li>
      <a href="index.html#HKD" class="price-toggle" data-currency="hkd">港币(HKD)</a></li>
    <li>
      <a href="index.html#RUB" class="price-toggle" data-currency="rub">卢布(RUB)</a></li>
    <li>
      <a href="index.html#INR" class="price-toggle" data-currency="inr">卢比(INR)</a></li>
    <li>
      <a href="index.html#AUD" class="price-toggle" data-currency="aud">澳元(AUD)</a></li>
    <li>
      <a href="index.html#EUR" class="price-toggle" data-currency="eur">欧元(EUR)</a></li>
    <li>
      <a href="index.html#CHF" class="price-toggle" data-currency="chf">法郎(CHF)</a></li>
    <li>
      <a href="index.html#GBP" class="price-toggle" data-currency="gbp">英镑(GBP)</a></li>
    <li>
      <a href="index.html#CAD" class="price-toggle" data-currency="cad">加元(CAD)</a></li>
    <li>
      <a href="index.html#IDR" class="price-toggle" data-currency="idr">印尼盾(IDR)</a></li>
    <li>
      <a href="index.html#BRL" class="price-toggle" data-currency="brl">巴西雷亚尔(BRL)</a></li>
    <li>
      <a href="index.html#MXN" class="price-toggle" data-currency="mxn">比索(MXN)</a></li>
  </ul>
</div>
<script>
  $(function(){
    //下拉菜单
    $('.slideBtn').click(function (e) {
        e.stopPropagation();
        if ($(this).find('ul').css('display') !== 'block') {
            $('.slideBtn').find('ul').css('display', 'none');
            $(this).find('ul').slideDown(100);
        }
        else {
            $('.slideBtn').find('ul').slideUp(100);
        }
    });
    $('.unit ul li').click(function () {
        $(this).closest('.slideBtn').find('button').text($(this).text());
        $('.slideBtn').find('ul').slideUp(100);

    });

    //点击屏幕取消
    $('html').click(
        function () {
            $('.slideBtn ul').slideUp(100);
        }
    );
  })
</script>

<script>
function toLocaleString(n, m) {
    if (m == null || m == "") {
        m = 0;
    }

    var str = n.toLocaleString();
    if (-1 == str.lastIndexOf(".")) {
        return str;
    }
    if (m > 0) {
        str = str.substring(0, str.lastIndexOf(".") + 1 + m);
    } else {
        str = str.substring(0, str.lastIndexOf(".") + m);
    }
    return str;
}
function format_market_cap(val) {
    if (val >= 1000000000) {
        val = Math.round(val / 100000000).toLocaleString() + "亿";
    } else if (val >= 100000000) {
        val = (val / 100000000).toFixed(2).toLocaleString() + "亿";
    } else if (val >= 1000000) {
        val = (val / 100000000).toFixed(4).toLocaleString() + "亿";
    } else if (val >= 1000) {
        val = toLocaleString(val, 0);
    }
    else {
        val = toLocaleString(val, 2);
    }
    return val;
}
function formatprice(val) {

    var price = val.toString();
    var indx = price.indexOf('.');
    var priceStr = price;
    var counter = 0;
    if (indx > -1) {
        for (var i = price.length - 1; i >= 1; i--) {
            if (price[i] == "0") {
                counter++;
                if (price[i - 1] == ".") {
                    counter++;
                    break;
                }
            } else {
                break;
            }
        }
        priceStr = "";
        for (var i = 0; i < price.length - counter; i++) {
            priceStr += price[i];
        }
    }
    return priceStr;

} 
function format_crypto(val) {
   
    var result;
    if (val >= 1000) {
        result = toLocaleString(val, 2);
    } else if (val >= 1) {
        result = val.toFixed(2);
    } else {
        if (val > 0.01) {
            result = val.toPrecision(4)
        } else {
            result = val.toFixed(8);
        }
    } 
    return result;
}
function format_crypto_volume(val) {
    if (val >= 1000000) {
        val = Math.round(val / 10000).toLocaleString() + "万";
    } else if (val >= 100000) {
        val = (val / 10000).toLocaleString() + "万";
    } else if (val >= 1000) {
        val = (val / 10000).toFixed(2).toLocaleString() + "万";
    } else if (val >= 100) {
        val = val.toFixed(0).toLocaleString();
    } else if (val >= 0.1) {
        val = val.toFixed(2).toLocaleString();
    }
    else {
        val = val.toFixed(4).toLocaleString();
    }

    return formatprice(val);
}
var currencyCNName = {
    "usd": "美元",
    "eur": "€",
    "cny": "人民币",
    "gbp": "英镑",
    "cad": "加元",
    "rub": "卢布",
    "hkd": "港币",
    "jpy": "日元",
    "aud": "澳元",
    "brl": "巴西雷亚尔",
    "inr": "印尼盾",
    "krw": "韩币",
    "mxn": "比索",
    "idr": "印尼盾",
    "chf": "法郎",
    "eth": "以太坊",
    "btc": "比特币"
};

function toggle_currency(currency) {
    var currency_uppercase = currency.toUpperCase();
    var currency_lowercase = currency.toLowerCase();
    var currency_symbols = {
        "usd": "$",
        "eur": "€",
        "cny": "¥",
        "gbp": "£",
        "cad": "$",
        "rub": "<img src='/assets/images/ruble.gif'/>",
        "hkd": "$",
        "jpy": "¥",
        "aud": "$",
        "brl": "R$",
        "inr": "₹",
        "krw": "₩",
        "mxn": "$",
        "idr": "Rp",
        "chf": "Fr",
    };
    $("#currency-switch-button").html(currencyCNName[currency_lowercase] + '(' + currency_uppercase + ')<span class="caret"></span>');

    if (currency_lowercase == "btc") {
        $.each([$('.market-cap'), $('.price'), $('.volume')], function () {
            selector_type = this.selector
            $.each(this, function (key, value) {
                amount = $(this).data("btc");

                if (amount != "?") {
                    amount = parseFloat(amount)
                    if (selector_type == ".price") {
                        amount = format_crypto(amount);
                    } else if (selector_type == ".volume") {
                        amount = format_crypto_volume(amount);
                    } else {
                        amount = format_market_cap(amount);
                    }
                }
                $(this).html(amount + " BTC")
            });
        });
    }
    else if (currency_lowercase == "cny") {
        $.each([$('.market-cap'), $('.price'), $('.volume')], function () {
            selector_type = this.selector
            $.each(this, function (key, value) {
                amount = $(this).data("cny");

                if (amount != "?") {
                    amount = parseFloat(amount)
                    if (selector_type == ".price") {
                        amount = format_crypto(amount);
                    } else if (selector_type == ".volume") {
                        amount = format_crypto_volume(amount);
                    } else {
                        amount = format_market_cap(amount);
                    }
                    $(this).html(currency_symbols[currency_lowercase] + amount)
                } else {
                    $(this).html(amount)
                }

            });
        });
    }
    else if (currency_lowercase == "eth") {
        foreign_amount = $("#currency-exchange-rates").data(currency_lowercase);
        $.each([$('.market-cap'), $('.price'), $('.volume')], function () {
            selector_type = this.selector
            $.each(this, function (key, value) {
                slug = $(this).closest('tr').attr("id");
                amount = $(this).data("usd");

                if (amount != "?") {
                    amount = parseFloat(amount) / foreign_amount
                    if (selector_type == ".price") {
                        if (slug == "id-ethereum") {
                            amount = 1;
                        }
                        amount = format_crypto(amount);
                    } else if (selector_type == ".volume") {
                        amount = format_crypto_volume(amount);
                    } else {
                        amount = format_market_cap(amount);
                    }
                }
                $(this).html(amount + " ETH")
            });
        });
    } else {
        foreign_amount = $("#currency-exchange-rates").data(currency_lowercase);
        $.each([$('.market-cap'), $('.price'), $('.volume')], function () {
            selector_type = this.selector
            $.each(this, function (key, value) {
                amount = $(this).data("usd");

                if (amount != "?") {
                    amount = parseFloat(amount) / foreign_amount
                    if (selector_type == ".price") {
                        amount = format_crypto(amount);
                    } else if (selector_type == ".volume") {
                        amount = format_crypto_volume(amount);
                    } else {
                        amount = format_market_cap(amount);
                    }
                    $(this).html(currency_symbols[currency_lowercase] + amount);
                } else {
                    $(this).html(amount);
                }

            });
        });
    }
    data_symbol = currency_lowercase
    if (currency_lowercase != "btc") {
        data_symbol = "usd"
    }
    $.each([$('.percent-1h'), $('.percent-24h'), $('.percent-7d')], function () {
        $.each(this, function (key, value) {
            slug = $(this).closest('tr').attr("id");
            if (slug == "id-ethereum" && currency_lowercase == "eth") {
                $(this).html("0.00" + "%")
            } else {
                convert_percent($(this), data_symbol)
            }
        });
    });
}
function toggle_native() {
    $("#currency-switch-button").html("平台价格" + " <span class=\"caret\"></span>");
    $.each([$('.price'), $('.volume')], function () {
        selector_type = this.selector
        $.each(this, function (key, value) {
            amount = $(this).data("native");
            if (amount == null) {
                amount = "N/A";
            }
            else if (amount != "?") {
                amount = parseFloat(amount)
                if (selector_type == ".price") {
                    amount = format_crypto(amount);
                } else if (selector_type == ".volume") {
                    amount = format_crypto_volume(amount);
                } else {
                    amount = format_market_cap(amount);
                }
            }
            $(this).html(amount);
        });
    });
}
function toggle_platform() {
    $("#currency-switch-button").html("Platform" + " <span class=\"caret\"></span>");
    $.each([$('.market-cap'), $('.price'), $('.volume')], function () {
        selector_type = this.selector
        $.each(this, function (key, value) {
            amount = $(this).data("platform");
            var platform_symbol = $(this).closest('tr').data("platformsymbol");
            if (amount == null || amount === "None") {
                amount = "?";
            }
            else if (amount != "?") {
                amount = parseFloat(amount)
                if (selector_type == ".price") {
                    amount = format_crypto(amount);
                } else {
                    amount = format_market_cap(amount);
                }
            }
            var text = amount + " " + platform_symbol
            $(this).html(text);
        });
    });
    $.each([$('.percent-1h'), $('.percent-24h'), $('.percent-7d')], function () {
        $.each(this, function (key, value) {
            convert_percent($(this), "platform")
        });
    });
}
$(document).ready(function () {
    if (window.location.hash) {
        hash = window.location.hash.substring(1);
        if (hash == "native" || hash == "BTC" || hash == "ETH" || hash == "USD" || hash == "EUR" || hash == "CNY" || hash == "GBP" || hash == "CAD" || hash == "RUB" || hash == "HKD" || hash == "JPY" || hash == "AUD" || hash == "BRL" || hash == "INR" || hash == "KRW" || hash == "MXN" || hash == "IDR" || hash == "CHF") {
            if (hash == "native") {
                toggle_native();
            } else {
                toggle_currency(hash);
            }

            if ($(".unit2").length > 0) {
                for (var i = 0; i < $(".unit2 a").length; i++) {
                    $(".unit2 a").eq(i).removeClass("active");
                    if ("#" + hash == $(".unit2 a").eq(i).attr("href")) {
                        $(".unit2 a").eq(i).addClass("active");
                    }
                }
            }
        }

    }
    $(".price-toggle").click(function () {
        var text = $(this).text();
        $(this).closest('.unit').find('button').eq(0).html(text);
        var currency = $(this).data('currency');

        if (currency == "native") {
            toggle_native();
        } else if (currency == "platform") {
            toggle_platform();
        } else {
            toggle_currency(currency);
        }
    });
});
</script>  
<div style="display:none" id="currency-exchange-rates" data-cny="0.15609634266269143" data-usd="1" data-btc="10407.1" data-eth="937.01207246177455" data-jpy="0.009038240796811307" data-krw="0.0009309210066979767" data-hkd="0.1279132236690629" data-rub="0.017693180782728624" data-inr="0.01567275291905023" data-aud="0.796781004740847" data-eur="1.2246707472695966" data-chf="1.0394707846341271" data-gbp="1.3952177516344977" data-cad="0.8015710793154583" data-idr="7.47758696218376e-05" data-brl="0.3121297361005507" data-mxn="0.053277072744515125"></div>
<div class="m15"></div>
<style>
.disactive {
  float: left;
  background: #ddd;
  color: #999 !important;
  height: 25px;
  padding: 0 5px;
  margin-top: 4px;
  margin-left: 5px;
  line-height: 25px;
  border-radius: 3px
}
</style>
<table class="table noBg">
  <thead>
    <tr>
      <th>#</th>
      <th>名称</th>
      <th>交易对</th>
      <th>价格</th>
      <th>成交量</th>
      <th>成交额</th>
      <th>占比</th>
      <th>更新时间</th>
      <th>自选状态</th></tr>
  </thead>
  <tbody>
    <% (1..20).each do %>
    <tr>
      <td>1</td>
      <td>
        <a href="../currencies/bitcoin.html" target="_blank">
          <img src="https://static.eastcoinbay.com/Coin/7033f2f2c2a16094bbb3bafc47205ba8_small.png" alt="比特币-Bitcoin">比特币-Bitcoin</td>
      <td>BTC/USDT</td>
      <td class="price" data-usd="10237" data-cny="65581" data-btc="1" data-native="10221">¥65,581</td>
      <td>10,196</td>
      <td class="volume" data-usd="104372032" data-cny="668638548" data-btc="10196" data-native="10196">¥66,864万</td>
      <td>10.43%</td>
      <td>刚刚</td>
      <td>
        <div class="addto disactive" id="FocusCoinChose#bitcoin#huobipro#btc_usdt" onclick="addsitechose($(this));">添加自选</div>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
<style>
.tips {
  padding: 15px;
  color: #999;
  font-size: 12px
}
</style>
<div class="tips"></div>


<script>
  //取消自选（交易对）
  function cancelsitechose(keys) {
      
      var id = keys.attr("id");

      keys.attr("disabled", "disabled");
      keys.html("提交中...");
      var parms = new Object();
      var coincode = id.split("#")[1];
      var sitecode = id.split("#")[2];
      var symbolpair = id.split("#")[3];
      parms["coincode"] = coincode;
      parms["sitecode"] = sitecode;
      parms["symbolpair"] = symbolpair;
      parms["type"] = "2";
      $.ajax({
          url: "/user/post.coinsitefocus",
          data: parms,
          type: "post",
          async: true,
          xhrFields: {
              withCredentials: true
          },
          success: function (data) {
              cancelsitefocusResponse(data);
          }
      });
     

      function cancelsitefocusResponse(data) {


          var result = eval("(" + data + ")");
          if (result.status == "success") {
              keys.attr("onclick", "addsitechose($(this))");
              keys.attr("class", "addto disactive");
              keys.removeAttr("disabled");
              keys.html("添加自选");
          }
          else {
              alert(result.content);
              keys.removeAttr("disabled");
              keys.attr("class", "hasaddto disactive");
              keys.html("移除自选");
          }
      }
  }      

  //添加自选(交易对)
  function addsitechose(keys) {
      
      var id = keys.attr("id");

      keys.attr("disabled", "disabled");
      keys.html("提交中...");
      var parms = new Object();
      var coincode = id.split("#")[1];
      var sitecode = id.split("#")[2];
      var symbolpair = id.split("#")[3];
      parms["coincode"] = coincode;
      parms["sitecode"] = sitecode;
      parms["symbolpair"] = symbolpair;
      parms["type"] = "1";
     
      $.ajax({
          url: "/user/post.coinsitefocus",
          data: parms,
          type: "post",
          async: true,
          xhrFields: {
              withCredentials: true
          },
          success: function (data) {
              addsitefocusResponse(data);
          }
      });
      function addsitefocusResponse(data) {

          var result = eval("(" + data + ")");
          if (result.status == "success") {
              keys.attr("onclick", "cancelsitechose($(this))");
              keys.attr("class", "hasaddto disactive");

              keys.removeAttr("disabled");
              keys.html("移除自选");
          }
          else {
              alert(result.content);
              keys.removeAttr("disabled");
              keys.attr("class", "addto disactive");
              keys.html("添加自选");
          }

      }
  }
</script>